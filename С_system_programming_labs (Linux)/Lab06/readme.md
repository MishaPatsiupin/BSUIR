# Лабораторная работа №6: Работа с файлами, отображенными в память

## Цель работы
Изучение системных вызовов для работы с потоками и отображением файлов в память: `pthread_create()`, `pthread_exit()`, `pthread_join()`, `pthread_yield()`, `pthread_cancel()`, `pthread_barrier_init()`, `pthread_barrier_destroy()`, `pthread_barrier_wait()`, `mmap()`, `munmap()`.

## Задание
Написать многопоточную программу `sort_index` для сортировки вторичного индексного файла таблицы базы данных. Программа должна работать с файлом в двух режимах: `read()/write()` и с использованием отображения файлов в адресное пространство процесса.

Программа должна запускаться следующим образом:
```
sort_index memsize granul threads filename
```

### Параметры командной строки:
- `memsize` - размер рабочего буфера, кратный размеру страницы (`getpagesize()`)
- `blocks` - порядок разбиения буфера
- `threads` - количество потоков (от `k` до `N`), где `k` - количество ядер, `N` - максимальное количество потоков (8k??)
- `filename` - имя файла

Количество блоков должно быть степенью двойки и превышать количество потоков.

## Тестирование
Для целей тестирования написать программу генерации неотсортированного индексного файла.

### Алгоритм программы генерации
Генерируемый файл представляет собой вторичный индекс по времени и состоит из заголовка и индексных записей фиксированной длины.

Индексная запись имеет следующую структуру:
```c
struct index_s {
    double   time_mark; // временная метка (модифицированная юлианская дата)
    uint64_t recno;     // первичный индекс в таблице БД
} index_record;
```

Заголовок представляет собой следующую структуру:
```c
struct index_hdr_s {
    uint64_t       records; // количество записей
    struct index_s idx[];    // массив записей в количестве records
}
```

Временная метка определяется в модифицированных юлианских днях. Целая часть лежит в пределах от 15020.0 (1900.01.01-0:0:0.0) до «вчера». Дробная – это часть дня (0.5 –  12:0:0.0). Для генерации целой и дробной частей временной метки используется системный генератор случайных чисел (`random(3)`).

Первичный индекс, как вариант, может заполняться последовательно, начиная с 1, но может быть случайным целым > 0 (в программе сортировки не используется).

Размер индекса в записях должен быть кратен 256 и кратно превышать планируемую выделенную память для отображения. Размер индекса и имя файла указывается при запуске программы генерации.
